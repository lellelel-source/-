# åˆ¸ç æ ¸é”€ç³»ç»Ÿ

ä¸€ä¸ªåŸºäº Node.js + Express + SQLite çš„åˆ¸ç æ ¸é”€æ‰‹æœºH5åº”ç”¨ï¼Œæ”¯æŒç‰¹å®šæ‰‹æœºå·ç™»å½•ã€åˆ¸ç éªŒè¯ã€æ ¸é”€è®°å½•æŸ¥è¯¢ç­‰åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… **ç”¨æˆ·è®¤è¯**: ä»…ç‰¹å®šæ‰‹æœºå·å¯ç™»å½•ï¼Œä¸æ”¯æŒè‡ªä¸»æ³¨å†Œ
- âœ… **åˆ¸ç æ ¸é”€**: æ”¯æŒ8ä½å¤§å†™è‹±æ–‡+æ•°å­—ç»„åˆåˆ¸ç æ ¸é”€
- âœ… **ä¼ä¸šç®¡ç†**: ä¼ä¸šé€‰æ‹©æ”¯æŒä¸‹æ‹‰+æœç´¢åŠŸèƒ½
- âœ… **è®°å½•æŸ¥è¯¢**: å¯æŒ‰æ—¥æœŸæˆ–ä¼ä¸šæŸ¥è¯¢æ ¸é”€è®°å½•
- âœ… **å‰ç«¯éªŒè¯**: è¾“å…¥æ ¼å¼å®æ—¶éªŒè¯

### æŠ€æœ¯ç‰¹æ€§
- ğŸ“± **ç§»åŠ¨ç«¯ä¼˜åŒ–**: å“åº”å¼è®¾è®¡ï¼Œé€‚é…å„ç§ç§»åŠ¨è®¾å¤‡
- ğŸ” **å®‰å…¨è®¤è¯**: JWT tokenè®¤è¯ï¼Œè‡ªåŠ¨ç™»å½•çŠ¶æ€æ£€æŸ¥
- ğŸ’¾ **è½»é‡æ•°æ®åº“**: SQLiteæ•°æ®åº“ï¼Œæ— éœ€é¢å¤–é…ç½®
- ğŸš€ **é«˜æ€§èƒ½**: é˜²æŠ–æœç´¢ã€åˆ†é¡µåŠ è½½ã€APIç¼“å­˜
- ğŸ¨ **ç°ä»£UI**: ç¾è§‚çš„ç•Œé¢è®¾è®¡ï¼Œè‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ

## æŠ€æœ¯æ ˆ

### å‰ç«¯
- **HTML5** + **CSS3** + **åŸç”ŸJavaScript**
- å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒå„ç§ç§»åŠ¨è®¾å¤‡
- PWAç‰¹æ€§æ”¯æŒ

### åç«¯
- **Node.js** + **Express.js**
- **SQLite** æ•°æ®åº“
- **JWT** èº«ä»½è®¤è¯
- **bcrypt** å¯†ç åŠ å¯†

### éƒ¨ç½²
- æ”¯æŒ **Railway** éƒ¨ç½²
- æ”¯æŒ **Vercel** éƒ¨ç½²
- æ”¯æŒä¼ ç»ŸæœåŠ¡å™¨éƒ¨ç½²

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Node.js 16.0+
- npm æˆ– yarn

### å®‰è£…ä¾èµ–
```bash
npm install
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
npm run dev
```

### å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
```bash
npm start
```

åº”ç”¨å°†åœ¨ `http://localhost:3000` å¯åŠ¨

## é»˜è®¤è´¦å·

ç³»ç»Ÿå·²é¢„è®¾æµ‹è¯•è´¦å·ï¼š
- **æ‰‹æœºå·**: 13800138000
- **å¯†ç **: 123456

## æ•°æ®åº“ç»“æ„

### ç”¨æˆ·è¡¨ (users)
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”® |
| phone | VARCHAR(11) | æ‰‹æœºå·(å”¯ä¸€) |
| password_hash | VARCHAR(255) | å¯†ç å“ˆå¸Œ |
| is_active | BOOLEAN | æ˜¯å¦æ¿€æ´» |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |

### ä¼ä¸šè¡¨ (companies)
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”® |
| name | VARCHAR(255) | ä¼ä¸šåç§°(å”¯ä¸€) |
| is_active | BOOLEAN | æ˜¯å¦æ¿€æ´» |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |

### åˆ¸ç è¡¨ (coupons)
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”® |
| code | VARCHAR(8) | åˆ¸ç (å”¯ä¸€) |
| company_id | INTEGER | å…³è”ä¼ä¸šID |
| is_used | BOOLEAN | æ˜¯å¦å·²ä½¿ç”¨ |
| used_at | DATETIME | ä½¿ç”¨æ—¶é—´ |
| used_by | VARCHAR(11) | ä½¿ç”¨è€…æ‰‹æœºå· |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |

### æ ¸é”€è®°å½•è¡¨ (verification_logs)
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”® |
| coupon_id | INTEGER | åˆ¸ç ID |
| user_phone | VARCHAR(11) | æ“ä½œå‘˜æ‰‹æœºå· |
| verification_time | DATETIME | æ ¸é”€æ—¶é—´ |
| ip_address | VARCHAR(45) | IPåœ°å€ |

## API æ¥å£

### è®¤è¯æ¥å£

#### ç”¨æˆ·ç™»å½•
```http
POST /api/auth/login
Content-Type: application/json

{
  "phone": "13800138000",
  "password": "123456"
}
```

#### éªŒè¯token
```http
GET /api/auth/verify
Authorization: Bearer <token>
```

#### ç”¨æˆ·é€€å‡º
```http
POST /api/auth/logout
Authorization: Bearer <token>
```

### åˆ¸ç æ¥å£

#### è·å–ä¼ä¸šåˆ—è¡¨
```http
GET /api/coupon/companies?search=å…³é”®è¯
Authorization: Bearer <token>
```

#### æ ¸é”€åˆ¸ç 
```http
POST /api/coupon/verify
Authorization: Bearer <token>
Content-Type: application/json

{
  "code": "ABC12345",
  "companyId": 1
}
```

#### æŸ¥è¯¢æ ¸é”€è®°å½•
```http
GET /api/coupon/records?date=2024-01-01&companyId=1&page=1&limit=20
Authorization: Bearer <token>
```

#### æ‰¹é‡ç”Ÿæˆåˆ¸ç ï¼ˆæµ‹è¯•ç”¨ï¼‰
```http
POST /api/coupon/batch-add
Authorization: Bearer <token>
Content-Type: application/json

{
  "companyId": 1,
  "count": 10
}
```

## éƒ¨ç½²æŒ‡å—

### Railway éƒ¨ç½²

1. æ¨é€ä»£ç åˆ° GitHub
2. åœ¨ Railway å¯¼å…¥é¡¹ç›®
3. è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
   ```
   PORT=3000
   JWT_SECRET=your-secret-key
   ```
4. éƒ¨ç½²å®Œæˆ

### Vercel éƒ¨ç½²

1. å®‰è£… Vercel CLI: `npm i -g vercel`
2. åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ: `vercel`
3. æŒ‰æç¤ºå®Œæˆéƒ¨ç½²é…ç½®
4. è®¾ç½®ç¯å¢ƒå˜é‡

### ä¼ ç»ŸæœåŠ¡å™¨éƒ¨ç½²

1. ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨
2. å®‰è£…ä¾èµ–: `npm install --production`
3. é…ç½®ç¯å¢ƒå˜é‡
4. ä½¿ç”¨ PM2 å¯åŠ¨: `pm2 start server.js`

## å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„
```
.
â”œâ”€â”€ server.js              # æœåŠ¡å™¨å…¥å£æ–‡ä»¶
â”œâ”€â”€ package.json           # é¡¹ç›®é…ç½®
â”œâ”€â”€ README.md             # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ database/             # æ•°æ®åº“ç›¸å…³
â”‚   â””â”€â”€ init.js          # æ•°æ®åº“åˆå§‹åŒ–
â”œâ”€â”€ routes/              # è·¯ç”±æ–‡ä»¶
â”‚   â”œâ”€â”€ auth.js         # è®¤è¯è·¯ç”±
â”‚   â””â”€â”€ coupon.js       # åˆ¸ç è·¯ç”±
â”œâ”€â”€ public/              # å‰ç«¯æ–‡ä»¶
â”‚   â”œâ”€â”€ index.html      # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ styles/         # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ main.css
â”‚   â”‚   â””â”€â”€ mobile.css
â”‚   â””â”€â”€ scripts/        # JavaScriptæ–‡ä»¶
â”‚       â”œâ”€â”€ utils.js    # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ api.js      # APIè°ƒç”¨
â”‚       â”œâ”€â”€ auth.js     # è®¤è¯é€»è¾‘
â”‚       â””â”€â”€ main.js     # ä¸»è¦é€»è¾‘
â””â”€â”€ data/               # SQLiteæ•°æ®åº“æ–‡ä»¶ç›®å½•
```

### å¼€å‘å·¥å…·

#### ç”Ÿæˆæµ‹è¯•åˆ¸ç 
åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼ˆlocalhostï¼‰ï¼Œä½¿ç”¨å¿«æ·é”® `Ctrl+Shift+G` å¯å¿«é€Ÿç”Ÿæˆæµ‹è¯•åˆ¸ç ã€‚

#### API æµ‹è¯•
æ¨èä½¿ç”¨ Postman æˆ– curl æµ‹è¯•APIæ¥å£ã€‚

### æ·»åŠ æ–°ç”¨æˆ·

éœ€è¦æ‰‹åŠ¨åœ¨æ•°æ®åº“ä¸­æ·»åŠ ç”¨æˆ·ï¼š

```sql
INSERT INTO users (phone, password_hash) VALUES 
('æ‰‹æœºå·', 'åŠ å¯†åçš„å¯†ç ');
```

å¯ä»¥ä½¿ç”¨ bcrypt åœ¨çº¿å·¥å…·ç”Ÿæˆå¯†ç å“ˆå¸Œï¼Œæˆ–åœ¨å¼€å‘å·¥å…·ä¸­ä½¿ç”¨ï¼š
```javascript
const bcrypt = require('bcrypt');
const hash = bcrypt.hashSync('å¯†ç ', 10);
console.log(hash);
```

## å®‰å…¨è€ƒè™‘

1. **å¯†ç åŠ å¯†**: ä½¿ç”¨ bcrypt åŠ å¯†å­˜å‚¨
2. **JWTè®¤è¯**: 24å°æ—¶è¿‡æœŸæ—¶é—´
3. **è¾“å…¥éªŒè¯**: å‰åç«¯åŒé‡éªŒè¯
4. **SQLæ³¨å…¥é˜²æŠ¤**: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
5. **é™æµä¿æŠ¤**: APIè¯·æ±‚é¢‘ç‡é™åˆ¶

## æµè§ˆå™¨å…¼å®¹æ€§

- âœ… Chrome 80+
- âœ… Safari 13+
- âœ… Firefox 75+
- âœ… Edge 80+
- âœ… ç§»åŠ¨ç«¯æµè§ˆå™¨

## è®¸å¯è¯

MIT License

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. [å¸¸è§é—®é¢˜è§£ç­”](https://github.com/your-repo/issues)
2. [APIæ–‡æ¡£](https://your-domain.com/api-docs)
3. [éƒ¨ç½²æŒ‡å—](https://your-domain.com/deploy) 